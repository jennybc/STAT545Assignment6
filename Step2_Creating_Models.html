

<!DOCTYPE html>
<html>
<head>
<style type="text/css">.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}</style>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="http://yihui.name/knitr"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.4.1</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(lattice)</span>
<span class="hl kwd">library</span><span class="hl std">(plyr)</span>
<span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>
<span class="hl com"># Import the data, set the factors properly (trick shown to me by Sean Jewell)</span>
<span class="hl std">iDat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">read.delim</span><span class="hl std">(</span><span class="hl str">&quot;GapMinderData_Sorted_ExtraVariables.tsv&quot;</span><span class="hl std">)</span>
<span class="hl std">id</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">unique</span><span class="hl std">(iDat</span><span class="hl opt">$</span><span class="hl std">continent)</span>
<span class="hl std">iDat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">within</span><span class="hl std">(iDat, continent</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(continent),</span> <span class="hl kwc">levels</span> <span class="hl std">= id))</span>
<span class="hl com"># Investigating to make sure it worked out</span>
<span class="hl kwd">levels</span><span class="hl std">(iDat</span><span class="hl opt">$</span><span class="hl std">continent)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] "Africa"   "Asia"     "Americas" "Europe"
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">head</span><span class="hl std">(iDat)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   country year     pop continent lifeExp gdpPercap Continent_meanlifeExp minLifeExp
## 1  Rwanda 1952 2534927    Africa    40.0     493.3                 50.59       23.6
## 2  Rwanda 1957 2822082    Africa    41.5     540.3                 50.59       23.6
## 3  Rwanda 1962 3051242    Africa    43.0     597.5                 50.59       23.6
## 4  Rwanda 1967 3451079    Africa    44.1     511.0                 50.59       23.6
## 5  Rwanda 1972 3992121    Africa    44.6     590.6                 50.59       23.6
## 6  Rwanda 1977 4657072    Africa    45.0     670.1                 50.59       23.6
##   meanlifeexpbyyear
## 1             38.80
## 2             40.94
## 3             43.10
## 4             45.18
## 5             47.21
## 6             49.21
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">tail</span><span class="hl std">(iDat)</span>
</pre></div>
<div class="output"><pre class="knitr r">##      country year     pop continent lifeExp gdpPercap Continent_meanlifeExp minLifeExp
## 1675  Norway 1982 4114787    Europe   75.97     26299                 72.31      72.67
## 1676  Norway 1987 4186147    Europe   75.89     31541                 72.31      72.67
## 1677  Norway 1992 4286357    Europe   77.32     33966                 72.31      72.67
## 1678  Norway 1997 4405672    Europe   78.32     41283                 72.31      72.67
## 1679  Norway 2002 4535591    Europe   79.05     44684                 72.31      72.67
## 1680  Norway 2007 4627926    Europe   80.20     49357                 72.31      72.67
##      meanlifeexpbyyear
## 1675             72.56
## 1676             73.45
## 1677             74.44
## 1678             75.71
## 1679             77.02
## 1680             77.89
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Finding fits and coefficients using code modified from JB's data aggregation lecture.</span>
<span class="hl std">yearMin</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">min</span><span class="hl std">(iDat</span><span class="hl opt">$</span><span class="hl std">year)</span>
<span class="hl std">jFun</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">) {</span>
    <span class="hl std">fit</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">lm</span><span class="hl std">(lifeExp</span> <span class="hl opt">~</span> <span class="hl kwd">I</span><span class="hl std">(year</span> <span class="hl opt">-</span> <span class="hl std">yearMin), x)</span>
    <span class="hl std">estimates</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">append</span><span class="hl std">(</span><span class="hl kwd">coef</span><span class="hl std">(fit),</span> <span class="hl kwd">summary</span><span class="hl std">(fit)</span><span class="hl opt">$</span><span class="hl std">sigma)</span>
    <span class="hl kwd">names</span><span class="hl std">(estimates)</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;intercept&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;slope&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;sd_resid&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">return</span><span class="hl std">(estimates)</span>
<span class="hl std">}</span>
<span class="hl com"># Define best as the countries with the lowest residual standard error, i.e. lowest</span>
<span class="hl com"># sd_resid</span>
<span class="hl std">jCoefs</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">arrange</span><span class="hl std">(jCoefs, continent, sd_resid)</span>
<span class="hl com"># Create a data fame containing the fit details.</span>
<span class="hl std">jCoefs</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ddply</span><span class="hl std">(iDat,</span> <span class="hl opt">~</span><span class="hl std">country</span> <span class="hl opt">+</span> <span class="hl std">continent, jFun)</span>
<span class="hl std">jCoefs</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">arrange</span><span class="hl std">(jCoefs, continent)</span>
<span class="hl kwd">write.table</span><span class="hl std">(jCoefs,</span> <span class="hl str">&quot;GapMinder_LifeExp_LinearFitDetails.tsv&quot;</span><span class="hl std">,</span> <span class="hl kwc">quote</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;\t&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl com"># For each continent, find the 4 best and 4 worst fits.</span>
<span class="hl std">ExtremeCountries</span> <span class="hl kwb">&lt;-</span> <span class="hl std">jCoefs[</span><span class="hl opt">-</span><span class="hl kwd">length</span><span class="hl std">(jCoefs[,</span> <span class="hl num">1</span><span class="hl std">])</span><span class="hl opt">:-</span><span class="hl num">1</span><span class="hl std">, ]</span>
<span class="hl kwa">for</span> <span class="hl std">(con</span> <span class="hl kwa">in</span> <span class="hl kwd">levels</span><span class="hl std">(jCoefs</span><span class="hl opt">$</span><span class="hl std">continent)) {</span>
    <span class="hl std">n</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">length</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(jCoefs, continent</span> <span class="hl opt">==</span> <span class="hl std">con)[,</span> <span class="hl num">1</span><span class="hl std">])</span>
    <span class="hl std">ExtremeCountries</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">rbind</span><span class="hl std">(ExtremeCountries,</span> <span class="hl kwd">subset</span><span class="hl std">(jCoefs, continent</span> <span class="hl opt">==</span> <span class="hl std">con)[</span><span class="hl opt">-</span><span class="hl std">(n</span> <span class="hl opt">-</span> <span class="hl num">4</span><span class="hl std">)</span><span class="hl opt">:-</span><span class="hl num">5</span><span class="hl std">,</span>
        <span class="hl std">])</span>
<span class="hl std">}</span>
<span class="hl com"># Check it out.</span>
<span class="hl std">ExtremeCountries</span>
</pre></div>
<div class="output"><pre class="knitr r">##                    country continent intercept    slope sd_resid
## 1                  Algeria    Africa     43.37  0.56928   1.3230
## 2                   Angola    Africa     32.13  0.20934   1.4070
## 3                    Benin    Africa     39.59  0.33423   1.1747
## 4                 Botswana    Africa     52.93  0.06067   6.1122
## 49                 Tunisia    Africa     44.56  0.58784   1.5591
## 50                  Uganda    Africa     44.28  0.12159   3.1877
## 51                  Zambia    Africa     47.66 -0.06043   4.5287
## 52                Zimbabwe    Africa     55.22 -0.09302   7.2054
## 53             Afghanistan      Asia     29.91  0.27533   1.2228
## 54                 Bahrain      Asia     52.75  0.46751   1.6396
## 55              Bangladesh      Asia     36.14  0.49813   0.9767
## 56                Cambodia      Asia     37.02  0.39590   5.6301
## 82                Thailand      Asia     52.66  0.34705   1.2049
## 83                 Vietnam      Asia     39.01  0.67162   1.3136
## 84      West Bank and Gaza      Asia     43.80  0.60110   1.9822
## 85             Yemen, Rep.      Asia     30.13  0.60546   1.5858
## 86               Argentina  Americas     62.69  0.23171   0.2923
## 87                 Bolivia  Americas     38.76  0.49993   1.1844
## 88                  Brazil  Americas     51.51  0.39009   0.3262
## 89                  Canada  Americas     68.88  0.21887   0.2492
## 107    Trinidad and Tobago  Americas     62.05  0.17366   1.6520
## 108          United States  Americas     68.41  0.18417   0.4161
## 109                Uruguay  Americas     65.74  0.18327   0.5337
## 110              Venezuela  Americas     57.51  0.32972   1.4818
## 111                Albania    Europe     59.23  0.33468   1.9831
## 112                Austria    Europe     66.45  0.24199   0.4074
## 113                Belgium    Europe     67.89  0.20908   0.2929
## 114 Bosnia and Herzegovina    Europe     58.09  0.34976   2.2567
## 137                 Sweden    Europe     71.61  0.16625   0.2118
## 138            Switzerland    Europe     69.45  0.22223   0.2149
## 139                 Turkey    Europe     46.02  0.49724   1.1471
## 140         United Kingdom    Europe     68.81  0.18597   0.4421
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Save the Data and Fits for the Extreme Countries</span>
<span class="hl kwd">write.table</span><span class="hl std">(ExtremeCountries,</span> <span class="hl str">&quot;GapMinder_LifeExp_LinearFitExtremes.tsv&quot;</span><span class="hl std">,</span> <span class="hl kwc">quote</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;\t&quot;</span><span class="hl std">,</span>
    <span class="hl kwc">row.names</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl com"># Merge with more information so that we can generate better plots.</span>
<span class="hl std">ExtremeCountriesbyYear</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">merge</span><span class="hl std">(ExtremeCountries,</span> <span class="hl kwd">subset</span><span class="hl std">(iDat, country</span> <span class="hl opt">%in%</span> <span class="hl std">ExtremeCountries</span><span class="hl opt">$</span><span class="hl std">country))</span>
<span class="hl std">ExtremeCountriesbyYear</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">within</span><span class="hl std">(ExtremeCountriesbyYear, country</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">reorder</span><span class="hl std">(country, sd_resid))</span>
<span class="hl com"># A loop which creates the desired plots.</span>
<span class="hl std">PreFilename</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;Facetted Scatter Plot of Life Expectancy Versus Year for Extreme Countries in&quot;</span>
<span class="hl kwa">for</span> <span class="hl std">(con</span> <span class="hl kwa">in</span> <span class="hl kwd">levels</span><span class="hl std">(ExtremeCountriesbyYear</span><span class="hl opt">$</span><span class="hl std">continent)) {</span>
    <span class="hl std">title</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">paste</span><span class="hl std">(PreFilename, con,</span> <span class="hl str">&quot;pdf&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;.&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">pdf</span><span class="hl std">(title)</span>
    <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">xyplot</span><span class="hl std">(lifeExp</span> <span class="hl opt">~</span> <span class="hl std">year</span> <span class="hl opt">|</span> <span class="hl std">country,</span> <span class="hl kwd">subset</span><span class="hl std">(ExtremeCountriesbyYear, continent</span> <span class="hl opt">==</span> <span class="hl std">con),</span>
        <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;p&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;r&quot;</span><span class="hl std">),</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Life Expectancy&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Year&quot;</span><span class="hl std">,</span> <span class="hl kwc">layout</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">4</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">)))</span>
    <span class="hl kwd">dev.off</span><span class="hl std">()</span>
<span class="hl std">}</span>
</pre></div>
</div></div>


  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.0.2 (2013-09-25)
## Platform: x86_64-apple-darwin10.8.0 (64-bit)
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] knitr_1.4.1     ggplot2_0.9.3.1 plyr_1.8        lattice_0.20-23
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_1.2-3   dichromat_2.0-0    digest_0.6.3       evaluate_0.4.7    
##  [5] formatR_0.9        grid_3.0.2         gtable_0.1.2       highr_0.2.1       
##  [9] labeling_0.2       MASS_7.3-29        munsell_0.4.2      proto_0.3-10      
## [13] RColorBrewer_1.0-5 reshape2_1.2.2     scales_0.2.3       stringr_0.6.2     
## [17] tools_3.0.2
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] "2013-10-21 01:15:52 PDT"
</pre></div>
</div></div>




</body>
</html>
